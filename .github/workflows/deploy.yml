- name: Deploy with SAM
  run: |
    sam build
    sam deploy --no-confirm-changeset \
      --stack-name ec2-auto-healing \
      --capabilities CAPABILITY_IAM \
      --region ap-south-1 \
      --parameter-overrides \
        VpcId=${{ secrets.VPC_ID }} \
        SubnetIds=${{ secrets.SUBNET_IDS }} \
        KeyName=${{ secrets.KEY_NAME }} \
        ImageId=${{ secrets.AMI_ID }}
  env:
    AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
    AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
